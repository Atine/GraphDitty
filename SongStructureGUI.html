<html>
<head>
<script src="UtilityFunctions.js"></script>
<script src="StructureCanvas.js"></script>
<style>
body {
    background-color: #202020;
    color:#CCCCCC;
}
</style>
</head>
<body>

<h1>Song Structure GUI</h1>
<h2>by Chris Tralie</h2>

<h3>Directions</h3>
<ul>
<li>Load in a JSON file generated by SongStructure.py.  The similarity matrix is shown up top, and the Laplacian eigenvectors are shown on the bottom</li>
<li>Click Play/Pause to Play/Pause the audio</li>
<li>Left click on the similarity matrix to jump the song to the row index of the selected point</li>
<li>Right click on the similarity matrix to jump to the column index of the selected point</li>
<li>Left or right click on the Laplacian eigenvectors to jump to the corresponding place in the audio</li>
</ul>

<HR>
<table>
<tr><td><h3>File Input</h3></td><td><input type = "file" id = "fileInput"></td><td colspan = "2"></td></tr>
</table>



<table>
<tr>
    <td><audio id="audio_main" controls></audio></td>
</tr>

<tr>
    <td><h3><p id = "songname"></p></h3></td>
</tr>

<tr>
    <td>
        <canvas id="SimilarityCanvas" width="800" height="700">
    </td>
</tr>

<tr>
    <td>
        <canvas id="EigCanvas" width="800" height="100">
    </td>
</tr>

<tr><td></td>
    <h3><p id = "pagestatus"><font color = "yellow">Waiting for user input...</font></p></h3>
</td></tr>
</table>

<script>
    //https://www.w3schools.com/tags/ref_av_dom.asp
    var audio = document.getElementById("audio_main");
    var waitingDisp = document.getElementById("pagestatus");
    var playing = false;
    var songnameTxt = document.getElementById("songname");
    var ssmcanvas = document.getElementById('SimilarityCanvas');
    var eigcanvas = document.getElementById('EigCanvas');
    var dimsUpdated = false;

    ssmctx = ssmcanvas.getContext('2d');
    eigctx = eigcanvas.getContext('2d');
	initCanvasHandlers();

    var fileInput = document.getElementById('fileInput');
	fileInput.addEventListener('change', function(e) {
		var file = fileInput.files[0];
		var reader = new FileReader();
		reader.onload = function(e) {
            var Results = JSON.parse(reader.result);
            //Setup audio buffers
            audio.src = Results.audio;
            times = Results.times;
            songnameTxt.innerHTML = Results.songname;
            CSImage.src = Results.W;
            if ('v' in Results) {
                EigImage.src = Results.v;
            }
            dimsUpdated = 0;
            offsetidx = 0;
            requestAnimationFrame(updateSSMCanvas);
            changeToReady();
		}
		reader.readAsText(file);
    });
    
    coldStartAudio = function() {
        offsetidx = 0;
        requestAnimationFrame(updateSSMCanvas);
    }
    audio.addEventListener("play", coldStartAudio);
    audio.addEventListener("pause", coldStartAudio);
    audio.addEventListener("seek", coldStartAudio);
</script>


</body>
</html>
